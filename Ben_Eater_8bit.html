<!DOCTYPE html>

<html>

<head>
<title>Ben Eater's 8-bit Computer Simulation</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

<script>

var image = new Image();

var red_on = "#ffcc88";
var red_off = "#bb2222";
var yellow_on = "#ffff00";
var yellow_off = "#e0980e";
var blue_on = "#e4f3ff";
var blue_off = "#162560";
var green_on = "#daff0c";
var green_off = "#185621";

var clock_LEDs = [ [true,232,6] ];
var x1_LEDs = [ [true,45,111] ];  // Green near Address Register DIP Switch
var x2_LEDs = [ [true,55,111] ];  // Red near Address Register DIP Switch

var program_ctr_LEDs = [ [false,386,6],
                         [true,395,6],
                         [false,404,6],
                         [true,413,6] ];

var ucode_ctr_LEDs = [ [false,33,395],
                       [true,43,395],
                       [true,53,395] ];

var ucode_state_LEDs = [ [false,66,390],
                         [true,76,390],
                         [false,86,390],
                         [false,96,390],
                         [true,106,390] ];

var bus_value_LEDs = [ [false,289,6],
                       [true,298,6],
                       [false,307,6],
                       [true,316,6],
                       [false,325,6],
                       [true,334,6],
                       [false,343,6],
                       [true,352,6] ];

var mem_address_LEDs = [ [false,147,145],
                         [true,157,146],
                         [false,166,145],
                         [true,176,146] ];

var register_A_LEDs = [ [false,422,134],
                        [true,432,134],
                        [false,443,134],
                        [true,453,134],
                        [false,464,134],
                        [true,474,134],
                        [false,485,134],
                        [true,495,134] ];

var register_B_LEDs = [ [false,424,290],
                        [true,434,290],
                        [false,445,290],
                        [true,455,290],
                        [false,466,290],
                        [true,477,290],
                        [false,488,290],
                        [true,498,290] ];

var sum_register_LEDs = [ [false,368,220],
                          [true,377,221],
                          [false,389,221],
                          [true,400,222],
                          [false,409,222],
                          [true,419,222],
                          [false,429,222],
                          [true,441,220] ];

var carry_flag_LEDs = [ [true,562,133] ];

var zero_flag_LEDs = [ [true,572,133] ];

var instr_high_LEDs = [ [false,148,369],
                        [true,157,370],
                        [false,166,371],
                        [true,177,371] ];

var instr_low_LEDs = [ [false,187,371],
                       [true,197,371],
                       [false,207,371],
                       [true,217,371] ];

var mem_contents_LEDs = [ [true,138,225],
                          [false,147,225],
                          [true,156,225],
                          [true,166,225],
                          [false,176,225],
                          [true,187,225],
                          [false,198,225],
                          [true,208,225] ];

var control_word_LEDs = [ [true,366,497],
                          [false,376,497],
                          [false,385,497],
                          [true,394,497],
                          [false,403,497],
                          [true,412,497],
                          [false,421,497],
                          [true,430,497],
                          [false,439,497],
                          [true,448,497],
                          [false,457,497],
                          [true,466,497],
                          [false,475,497],
                          [true,484,497],
                          [false,493,497],
                          [true,502,497] ];
function setup() {
    var canvas = document.getElementById('drawing_area');
    if (canvas != null) {
      var ctxt = canvas.getContext('2d');
      var w = canvas.width = 640;
      var h = canvas.height = 546;
      var image = new Image();
      image.onload = function () {
        // Draw the background image
        ctxt.drawImage(image,0,0);

        // Draw the Clock light
        for (let i=0; i<clock_LEDs.length; i++) {
          if (clock_LEDs[i][0]) {
            ctxt.fillStyle = blue_on;
          } else {
            ctxt.fillStyle = blue_off;
          }
          ctxt.beginPath();
          ctxt.arc(clock_LEDs[i][1], clock_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the x1 light
        for (let i=0; i<x1_LEDs.length; i++) {
          if (x1_LEDs[i][0]) {
            ctxt.fillStyle = green_on;
          } else {
            ctxt.fillStyle = green_off;
          }
          ctxt.beginPath();
          ctxt.arc(x1_LEDs[i][1], x1_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }
        // Draw the x2 light
        for (let i=0; i<x2_LEDs.length; i++) {
          if (x2_LEDs[i][0]) {
            ctxt.fillStyle = red_on;
          } else {
            ctxt.fillStyle = red_off;
          }
          ctxt.beginPath();
          ctxt.arc(x2_LEDs[i][1], x2_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Program Counter
        for (let i=0; i<program_ctr_LEDs.length; i++) {
          if (program_ctr_LEDs[i][0]) {
            ctxt.fillStyle = green_on;
          } else {
            ctxt.fillStyle = green_off;
          }
          ctxt.beginPath();
          ctxt.arc(program_ctr_LEDs[i][1], program_ctr_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Microcode Counter
        for (let i=0; i<ucode_ctr_LEDs.length; i++) {
          if (ucode_ctr_LEDs[i][0]) {
            ctxt.fillStyle = red_on;
          } else {
            ctxt.fillStyle = red_off;
          }
          ctxt.beginPath();
          ctxt.arc(ucode_ctr_LEDs[i][1], ucode_ctr_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Microcode State
        for (let i=0; i<ucode_state_LEDs.length; i++) {
          if (ucode_state_LEDs[i][0]) {
            ctxt.fillStyle = green_on;
          } else {
            ctxt.fillStyle = green_off;
          }
          ctxt.beginPath();
          ctxt.arc(ucode_state_LEDs[i][1], ucode_state_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Bus lights
        for (let i=0; i<bus_value_LEDs.length; i++) {
          if (bus_value_LEDs[i][0]) {
            ctxt.fillStyle = blue_on;
          } else {
            ctxt.fillStyle = blue_off;
          }
          ctxt.beginPath();
          ctxt.arc(bus_value_LEDs[i][1], bus_value_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Memory Address lights
        for (let i=0; i<mem_address_LEDs.length; i++) {
          if (mem_address_LEDs[i][0]) {
            ctxt.fillStyle = yellow_on;
          } else {
            ctxt.fillStyle = yellow_off;
          }
          ctxt.beginPath();
          ctxt.arc(mem_address_LEDs[i][1], mem_address_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the A Register lights
        for (let i=0; i<register_A_LEDs.length; i++) {
          if (register_A_LEDs[i][0]) {
            ctxt.fillStyle = red_on;
          } else {
            ctxt.fillStyle = red_off;
          }
          ctxt.beginPath();
          ctxt.arc(register_A_LEDs[i][1], register_A_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the B Register lights
        for (let i=0; i<register_B_LEDs.length; i++) {
          if (register_B_LEDs[i][0]) {
            ctxt.fillStyle = red_on;
          } else {
            ctxt.fillStyle = red_off;
          }
          ctxt.beginPath();
          ctxt.arc(register_B_LEDs[i][1], register_B_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Sum Register lights
        for (let i=0; i<sum_register_LEDs.length; i++) {
          if (sum_register_LEDs[i][0]) {
            ctxt.fillStyle = red_on;
          } else {
            ctxt.fillStyle = red_off;
          }
          ctxt.beginPath();
          ctxt.arc(sum_register_LEDs[i][1], sum_register_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Carry Flag light
        for (let i=0; i<carry_flag_LEDs.length; i++) {
          if (carry_flag_LEDs[i][0]) {
            ctxt.fillStyle = green_on;
          } else {
            ctxt.fillStyle = green_off;
          }
          ctxt.beginPath();
          ctxt.arc(carry_flag_LEDs[i][1], carry_flag_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Zero Flag light
        for (let i=0; i<zero_flag_LEDs.length; i++) {
          if (zero_flag_LEDs[i][0]) {
            ctxt.fillStyle = green_on;
          } else {
            ctxt.fillStyle = green_off;
          }
          ctxt.beginPath();
          ctxt.arc(zero_flag_LEDs[i][1], zero_flag_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Instruction Register High lights
        for (let i=0; i<instr_high_LEDs.length; i++) {
          if (instr_high_LEDs[i][0]) {
            ctxt.fillStyle = blue_on;
          } else {
            ctxt.fillStyle = blue_off;
          }
          ctxt.beginPath();
          ctxt.arc(instr_high_LEDs[i][1], instr_high_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Instruction Register Low lights
        for (let i=0; i<instr_low_LEDs.length; i++) {
          if (instr_low_LEDs[i][0]) {
            ctxt.fillStyle = yellow_on;
          } else {
            ctxt.fillStyle = yellow_off;
          }
          ctxt.beginPath();
          ctxt.arc(instr_low_LEDs[i][1], instr_low_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Memory Contents lights
        for (let i=0; i<mem_contents_LEDs.length; i++) {
          if (mem_contents_LEDs[i][0]) {
            ctxt.fillStyle = red_on;
          } else {
            ctxt.fillStyle = red_off;
          }
          ctxt.beginPath();
          ctxt.arc(mem_contents_LEDs[i][1], mem_contents_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }

        // Draw the Control Word lights
        for (let i=0; i<control_word_LEDs.length; i++) {
          if (control_word_LEDs[i][0]) {
            ctxt.fillStyle = blue_on;
          } else {
            ctxt.fillStyle = blue_off;
          }
          ctxt.beginPath();
          ctxt.arc(control_word_LEDs[i][1], control_word_LEDs[i][2], 5, 0, 2 * Math.PI);
          ctxt.fill();
          ctxt.closePath();
        }


        // ctxt.fillStyle = "#ff8888";
        // ctxt.fillRect((w/2)-10,(h/2)-10,20,20);

      };
      image.src = 'computer_background_640.png';
    }
}

function draw_canvas() {
  // window.alert ( "Draw Canvas" );
  var drawing_area = document.getElementById ( "drawing_area" );
  if (drawing_area != null) {
    var ctxt = drawing_area.getContext("2d");
    var w = drawing_area.width;
    var h = drawing_area.height;

    image.onload = function () {
        ctxt.drawImage(image,5,5);
    };

  }
}

window.onload = setup;

setup();

</script>

</head>

<body id='page' onload="setup()" onresize="setup()" bgcolor="lightblue">
<!--body id='page' bgcolor="lightblue"-->

<canvas id="drawing_area"></canvas>

</body>
